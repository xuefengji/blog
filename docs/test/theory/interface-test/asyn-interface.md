# 异步接口测试

## 同步接口与异步接口

### 什么是同步接口

**同步接口**：
当发送一个接口请求信息给其他系统，其他系统会同时返回一个处理的结果（status_code，msg，如果查询类的返回查询结果）

**同步的缺点**：
+ 所有的操作都做完，才返回给用户结果
+ 用户体验不好

### 什么是异步接口

**异步接口**：
因为某个接口业务需要较长时间的处理，为了不影响其他的功能，被调用系统在校验字符串符合要求后，直接返回一个简单的结果（比如一个id信息）供后续查询结果

**异步的优点**：
+ 不用等所有操作等做完，就响应用户请求
+ 用户体验较好

::: tip 总结：
同步：强依赖对方，必须等到回复，才能做出下一步响应，会被阻塞
异步：非阻塞的，不存在等待的状态
:::

## 异步接口流程及应用

### 异步接口的一般流程

> 提交请求接口

当请求一个异步接口,接口会立刻返回一个结果告诉已经开始处理，结果中一般会包含一个任务 id 类似的东西用于追踪结果。

> 查询结果

会提供一个查询结果的接口，当结果未处理完查询接口会返回相应的"未完成"状态，如果已经处理完，则会返回相应的数据。

### 异步接口处理方法

+ 一般采取轮询的方法，每隔一定时间间隔去请求一下查询结果的接口，直到接口返回的状态是已完成（查询到指定数据或超时）。

+ 如果异步接口没有提供追踪 id 和查询接口，可以通过同样的方法轮询查取数据库数据或日志数据直到获取到指定结果或超时。

### 应用场景

当业务处理比较耗时，一般会采用异步处理的方式，这种异步处理的方式又叫 Future 模式。

## 异步接口常用测试方法

> 模拟和断言异步任务状态

+ 使用程序模拟异步任务，并对其进行断言验证
+ 测试用例设计时，需要从系统的角度评估整个异步任务流程

> 使用适当的工具和框架

+ 许多基于Web的微服务框架支持内置的功能来模拟、诊断和测试异步接口
+ 测试工具基本上用于将请求通过 HTTP/HTTPS 模拟发送到 API 端点，监视响应时间、状态代码和消息正文

> 推迟断言

+ 在某些情况下，无法在超时期限内获得异步响应或仅在某些实际操作后才能获得响应（例如打开某个窗口、更新某个记录等）
+ 在这种情况下，可以推迟断言，直到达到“预期状态”才执行
+ 有效地控制测试环境改变，提交请求并等待结果重新计算

> 负载测试

+ 负载测试是测试异步接口的一个重要部分
+ 在负载测试期间，使用压力工具例如 Apache JMeter 或 Gatling 来模拟并发访问，并确定异步任务处理时间和吞吐量的边界值